<odoo>

    <record id="ganafote_report_invoice_document" model="ir.ui.view">
        <field name="name">ganafote.report.invoice.document</field>
        <field name="inherit_id" ref="account.report_invoice_document"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@class='page']/h2" position="replace">

                <t t-if="o.company_id.id == 1">
                    <t t-set="colorbackground" t-value="'background-color:#83c200; display:inline;border-radius: 20px; padding: 5px 10px;'" />
                </t>
                <t t-if="o.company_id.id != 1">
                    <t t-set="colorbackground" t-value="'background-color:#006eb7; display:inline;border-radius: 20px; padding: 5px 10px;'" />
                </t>

                <h2 style="color:#ffffff;">
                    <div t-att-style="colorbackground">
                        <span
                            t-if="o.move_type == 'out_invoice' and o.state == 'posted'"
                        >FACTURA
                        </span>
                        <span
                            t-if="o.move_type == 'out_invoice' and o.state == 'draft'"
                        >FACTURA BORRADOR
                        </span>
                        <span
                            t-if="o.move_type == 'out_invoice' and o.state == 'cancel'"
                        >FACTURA CANCELADA
                        </span>
                        <span
                            t-if="o.move_type == 'out_refund'"
                        >FACTURA RECTIFICATIVA
                        </span>
                        <span
                            t-if="o.move_type == 'in_refund'"
                        >FACTURA RECTIFICATIVA DE PROVEEDOR
                        </span>
                        <span
                            t-if="o.move_type == 'in_invoice'"
                        >FACTURA DE PROVEEDOR
                        </span>
                        <span
                            t-if="o.name != '/'"
                            t-field="o.name"
                        />
                    </div>
                </h2>
            </xpath>
            <xpath expr="//table/thead" position="replace">
                <thead style="display: table-row-group">
                    <tr>
                        <th name="th_description" style="text-align:left;">Descripción</th>
                        <th name="th_quantity" style="text-align:right;">Cantidad</th>
                        <th name="th_priceunit" style="text-align:right;">Precio/U</th>
                        <th
                            name="th_discount"
                            t-if="display_discount"
                            style="text-align:right;"
                            groups="product.group_discount_per_so_line"
                        >
                            <span>Desc.%</span>
                        </th>
                        <th name="th_subtotal" style="text-align:right;">
                            <span
                                groups="account.group_show_line_subtotals_tax_excluded"
                            >Total
                            </span>
                            <span
                                groups="account.group_show_line_subtotals_tax_included"
                            >Total
                            </span>
                        </th>
                    </tr>
                </thead>
            </xpath>
            <xpath expr="//table/tbody" position="replace">
                <tbody class="invoice_tbody">
                    <t t-set="current_subtotal" t-value="0"/>
                    <t
                        t-set="lines"
                        t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"
                    />

                    <t t-foreach="lines" t-as="line">
                        <t
                            t-set="current_subtotal"
                            t-value="current_subtotal + line.price_subtotal"
                            groups="account.group_show_line_subtotals_tax_excluded"
                        />
                        <t
                            t-set="current_subtotal"
                            t-value="current_subtotal + line.price_total"
                            groups="account.group_show_line_subtotals_tax_included"
                        />

                        <tr
                            t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''"
                        >
                            <t
                                t-if="line.display_type == 'product'"
                                name="account_invoice_line_accountable"
                            >
                                <td name="account_invoice_line_name" style="margin: 0px; padding: 0px;">
                                    <span
                                        t-field="line.name"
                                        t-options="{'widget': 'text'}"
                                    />
                                </td>
                                <td style="text-align:right; margin: 0px; padding: 0px;" >
                                    <span t-field="line.quantity"/>
                                    <span
                                        t-field="line.product_uom_id"
                                        groups="uom.group_uom"
                                    />
                                </td>
                                <td style="text-align:right; margin: 0px; padding: 0px;"
                                    t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}"
                                >
                                    <span
                                        class="text-nowrap"
                                        t-field="line.price_unit"
                                    />
                                </td>
                                <td style="text-align:right; margin: 0px; padding: 0px;"
                                    t-if="display_discount"
                                    t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}"
                                >
                                    <span
                                        class="text-nowrap"
                                        t-field="line.discount"
                                    />
                                </td>
                                <!--  <td t-attf-class="text-left {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                      <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_ids))" id="line_tax_ids"/>
                                  </td> -->
                                <td class="o_price_total" style="text-align:right; margin: 0px; padding: 0px;">
                                    <span
                                        class="text-nowrap"
                                        t-field="line.price_subtotal"
                                        groups="account.group_show_line_subtotals_tax_excluded"
                                    />
                                    <span
                                        class="text-nowrap"
                                        t-field="line.price_total"
                                        groups="account.group_show_line_subtotals_tax_included"
                                    />
                                </td>
                            </t>
                            <t t-if="line.display_type == 'line_section'">
                                <td colspan="99" style="margin: 0px; padding: 0px;">
                                    <span
                                        t-field="line.name"
                                        t-options="{'widget': 'text'}"
                                    />
                                </td>
                                <t t-set="current_section" t-value="line"/>
                                <t t-set="current_subtotal" t-value="0"/>
                            </t>
                            <t t-if="line.display_type == 'line_note'">
                                <td colspan="99" style="margin: 0px; padding: 0px;">
                                    <span
                                        t-field="line.name"
                                        t-options="{'widget': 'text'}"
                                    />
                                </td>
                            </t>
                        </tr>

                        <t
                            t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')"
                        >
                            <tr class="is-subtotal text-right">
                                <td colspan="99" style="margin: 0px; padding: 0px;">
                                    <strong class="mr16">Subtotal</strong>
                                    <span
                                        t-esc="current_subtotal"
                                        t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"
                                    />
                                </td>
                            </tr>
                        </t>
                    </t>
                </tbody>
            </xpath>
            <xpath expr="//div[@name='payment_term']" position="after">
                <div>
                    Términos y condiciones: https://ganafote16.xtendoo.es/terms
                </div>
                <div
                    style="margin-top:5px; text-align: center;"
                >
                    <t t-if="o.company_id.id == 1">
                        <p
                            style="border: 2px solid #83c200; border-radius:20px; display:inline-block;text-align:center; padding:10px 20px; margin-top:5px;"
                        >CUENTA GAÑAFOTE SLU = IBAN ES74 0049 0012 7123 1219 3764
                        </p>
                    </t>
                    <t t-if="o.company_id.id == 2">
                        <p
                            style="border:2px solid #006eb7;border-radius:20px; display:inline-block;text-align:center; padding:10px 20px; margin-top:5px;"
                        >CUENTA GAÑAFOTE SPORTS EVENTS = IBAN ES34 0049 0012 7321 1219 3772
                        </p>
                    </t>
                </div>
                <div style="font-size:14px; margin-top:10px; page-break-inside: avoid;">
                    <span style="font-weight:bolder;">Información sobre protección de datos:</span>
                    Como responsable del tratamiento le informamos que
                    recabamos sus datos con la finalidad de prestarles el servicio solicitado y emitir la
                    correspondiente
                    factura del mismo. La base legal para el tratamiento de sus datos es la ejecución del servicio
                    contratado y la obligación legal de expedir la factura del mismo. Conservaremos sus datos el
                    tiempo estrictamente necesario para responder a exigencias legales. Los datos no se cederán a
                    terceros salvo en los casos en que exista una obligación legal. Puede ejercer sus derechos de
                    acceso,
                    rectificación, supresión y portabilidad de sus datos, y la limitación u oposición a su tratamiento a
                    través de nuestro correo electrónico o domicilio fiscal. De igual modo, podría interponer una
                    reclamación ante la Autoridad de Control en www.aepd.es.
                </div>
            </xpath>
        </field>
    </record>
</odoo>
